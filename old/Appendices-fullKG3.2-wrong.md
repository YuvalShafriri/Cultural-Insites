---

# Appendices

APPENDIX SCOPE LEGEND
[GB] Global Baseline — applies to all stages.
[SM-#] Stage-Mandatory — required when running Stage #.
[CA] Conditional Aid — consult when helpful; do not inline by default.

---

## [GB-1] CBSA General Guidelines
The Context-Based Significance Assessment (CBSA) method is a holistic, systematic approach to evaluating cultural heritage significance. It integrates both **physical** and **non-physical** aspects of a place and operates across multiple contexts — urban, landscape, historical, social, political, intangible heritage, thematic, and more. Central to CBSA is the **context effect**: values arise from context — the physical, historical, social, or thematic settings bestow meaning and importance on the asset. Conversely, when an asset is valued, its associated context also gains significance through that relationship. This reciprocal process is a key lens for interpreting and weighting values.


Key principles:
- **Holistic approach:** Values are interlinked; consider the place as a whole.
- **Evidence-based:** Always link values, contexts, and significance to tangible or documentary evidence.
- **Multiple perspectives:** Integrate professional, community, and stakeholder viewpoints.
- **Physical & Non-physical evidence:** Include material fabric, setting, and intangible associations.
- **Community involvement:** Engage local/community perspectives where possible.
- **Transparency:** Make reasoning explicit; document how conclusions are reached.
- **Engagement:** Use concise, vivid phrasing that remains evidence-grounded.

---

## [CA-V] Value Types and Definitions
Use plain words in outputs; avoid acronyms. Where relevant, adapt sub-categories.

- **Historical:** Association with past events, periods, people, or functions.  
- **Aesthetic:** Design, style, craftsmanship, materials, setting.  
- **Social:** Community attachment, use, cultural practices.  
- **Technological:** Construction methods or technical innovation embodied in fabric or process.  
- **Symbolic:** Represents identity, belief, collective meaning, emblematic forms.  
- **Landscape:** Contribution to wider visual / spatial / environmental setting.  
- **Scientific:** Potential for research, archaeological or archival study.  
- **Spiritual:** Religious or ritual significance.  
- **Environmental:** Ecological context, biodiversity, natural features.  
- **Urban:** Relationship to urban form, streetscape, spatial coherence.  
- **Mystery & Enigma:** Elements of uncertain origin/meaning that stimulate interpretation and cultural curiosity.  
- **Functional:** Continued or adapted practical use that sustains relevance.  
- **Educational:** Supports learning, interpretation, heritage awareness.  

### [CA-V-MAP] Value Types — Bilingual Mapping (EN ↔ HE)
| EN | HE |
| --- | --- |
| Aesthetic Value | ערך אסתטי |
| Landscape Value | ערך נופי |
| Urban Value | ערך אורבני |
| Historical Value | ערך היסטורי |
| Scientific Value | ערך מדעי |
| Social Value | ערך חברתי |
| Spiritual Value | ערך רוחני |
| Functional Value | ערך פונקציונלי |
| Symbolic Value | ערך סמלי |
| Environmental Value | ערך סביבתי |
| Mystery & Enigma | ערך מסתורין |
| Technological Value | ערך טכנולוגי |
| Educational Value | ערך חינוכי |
---

## [CA-C] Context Types
Geographic • Landscape • Urban • Historical • Social • Political • Technological • Environmental • Intangible Heritage • Thematic  
> Each selected context should be supported by evidence and linked to values.

### [CA-C-MAP] Context Types — Bilingual Mapping (EN ↔ HE)
| EN | HE |
| --- | --- |
| Geographic | הקשר גאוגרפי |
| Landscape | הקשר נופי |
| Urban | הקשר אורבני |
| Historical | הקשר היסטורי |
| Social | הקשר חברתי |
| Political | הקשר פוליטי |
| Technological | הקשר טכנולוגי |
| Environmental | הקשר סביבתי |
| Intangible Heritage | מורשת בלתי מוחשית |
| Thematic | הקשר תמאטי |

---

## [CA-T] Change Types (lexicon)
Fabric • Infrastructure • Use • Setting • Interpretation  
> Use inside the last column of the unified Stage-2 table only when it clarifies the consequence.

---

## [SM-3] Integrity & Nara Grid Guidance
**Template columns:** Aspect | Description | Value Expression | Condition  
**Notes:** Compare current vs. original; cite specific attributes; tie condition back to Stage-2 values; explain briefly how any loss affects the value’s expression; avoid technical prescription.

---

## [CA-E] Examples & Phrasing Aids
**Comparative claims:** “Representative of… / Rare for… / Earliest example of…”  
**Consequence stems:** “Reduces legibility of… / Diminishes landmark presence… / Obscures original volume…”  
**Integrity phrasing:** “Later accretions partially obscure… / Original profile remains legible despite…”

---

## [CA-CS] Comparative Significance Criteria
Use these criteria in Stage 4 (Comparative Evaluation) and Stage 5 (Significance Statement) to support professional judgments.

- **Period:** Represents a significant era or phase in history.  
- **Rarity:** Few comparable examples exist locally, regionally, or nationally.  
- **Documentation:** Well-recorded in archives, plans, photographs, or oral histories.  
- **Connection to Ensemble:** Contributes to a group of related sites or features.  
- **Condition:** Degree of preservation of original fabric or setting.  
- **Selectivity/Diversity:** Contributes to the diversity of heritage types represented.  
- **Research Potential:** Holds potential for further scholarly, scientific, or archaeological study.

---
## [CA‑IMG] Image Analysis Aid (optional)
Purpose: derive contexts, physical features, condition, values, and comparatives from images provided by the user.
Output (when asked to analyze an image):
- Values spotted (with evidence in the image)
- Condition notes (materials, damage, alterations)
- Relevant contexts (time/place/setting)
- Quick comparatives (same type/period)
- Follow‑ups: what extra shot or doc would clarify

---
## [CA-EC] Entity Categories (EN ↔ HE)
Use these for KG node category selection when relevant to the site.

| EN | HE |
| --- | --- |
| Place | מקום |
| Structure / Building | מבנה |
| Architectural Element | אלמנט אדריכלי |
| Person | דמות |
| Event | אירוע |
| Story / Narrative | סיפור / נרטיב |
| Cultural Value | ערך תרבותי |
| Natural Phenomenon | תופעה טבעית |
| Artwork / Artefact | יצירת אמנות / ממצא |
| Tradition / Custom | מסורת / מנהג |
| Social Group | קבוצה חברתית |
| Historical Period | תקופה היסטורית |
| Religion / Belief | דת / אמונה |
| Collective Memory | זיכרון קולקטיבי |

---

## [CA-KG] Knowledge Graph Node Color Palette (Reference)
This table documents the color scheme for each node type in the knowledge graph. For actual rendering, see the COLOR_BY_TYPE map in `knowledge-graph-en.js`. Unmatched types use the 'general' fallback color.

| Type                  | Background (rgba)         | Border (hex)  | Notes           |
|-----------------------|--------------------------|---------------|-----------------|
| natural phenomenon    | rgba(30,144,255,0.7)     | #1E90FF       |                 |
| structure             | rgba(178,34,34,0.7)      | #B22222       |                 |
| architectural element | rgba(129,199,132,0.7)    | #81C784       |                 |
| person                | rgba(255,105,180,0.7)    | #FF69B4       |                 |
| event                 | rgba(255,160,122,0.7)    | #FFA07A       |                 |
| story / narrative     | rgba(255,228,181,0.7)    | #FFE4B5       |                 |
| social group          | rgba(255,215,0,0.7)      | #FFD700       |                 |
| cultural value        | rgba(255,193,7,0.7)      | #FFC107       |                 |
| place                 | rgba(100,149,237,0.7)    | #6495ED       |                 |
| artefact / artwork    | rgba(128,0,128,0.7)      | #800080       |                 |
| tradition / custom    | rgba(139,69,19,0.7)      | #8B4513       |                 |
| historical period     | rgba(0,180,180,0.7)      | #00B4B4       |                 |
| religion / belief     | rgba(218,112,214,0.7)    | #DA70D6       |                 |
| collective memory     | rgba(75,0,130,0.7)       | #4B0082       |                 |
| general (fallback)    | rgba(200,200,200,0.6)    | #666666       | fallback color  |

---
## [CA-KG] Knowledge Graph Recipe (optional at Stage 5)
Use this recipe when the user asks for a KG; otherwise only offer it. Visible labels mirror the user’s language; internal JSON keys remain in English.

Purpose: Generate an evidence-based Knowledge Graph (KG) from user‑supplied entities and relationships. Output = standalone HTML only (no extra prose).

Triggers:
- User explicit request: “Create KG / Generate knowledge graph / צור גרף ידע”.
- Mini-Agent invocation (see System Prompt).
Otherwise: at Stage 5 only OFFER (do not auto-generate).

Human-in-the-Loop (recommended):
1. List candidate nodes & edges (plain JSON) for approval.
2. After user confirms (or says “continue anyway”), produce final HTML.

Data Schema:
- DATA = { "nodes": [...], "edges": [...] }
- Node fields (all required): id (unique), name, type, meaning (5–12 words).
- Edge fields (all required): from (node id), to (node id), label (relationship verb).
- Escape rule: const DATA = __DATA_JSON__; where __DATA_JSON__ is JSON.stringify(DATA).

Localization Rule (IMPORTANT):
- Node name: user’s current language (local).
- Edge label: user’s current language (local).
- Node type: ALWAYS in English (controlled vocabulary from [CA-EC]) for consistency & downstream tooling.
- Internal JSON keys: English.
- HTML tag: <html lang="xx">; add dir="rtl" when language is Hebrew/Arabic.
- If user explicitly requests fully localized types, provide bilingual “Type (סוג)” but keep an English version inside type_original (optional extension).

Common Relationship Verbs (use those that fit; localize labels): located_in, part_of, associated_with, expresses_value, used_by, influenced_by, commemorates, built_by, represents, related_to.

Validation Checklist BEFORE HTML:
- All ids unique.
- Every edge references existing node ids.
- No empty meaning fields.
- Types drawn from [CA-EC] exactly (English).
- User approval obtained OR user explicitly waived.

Missing Data Handling:
If critical elements absent (e.g., <2 nodes, no edges, or missing meanings) show banner “⚠️ Running with missing data.” Ask for:
- List of core entities (name + type + meaning).
- At least one relationship verb connecting them.

Sample DATA Object (Tabgha example):
```json
{
  "nodes": [
    { "id": 1, "name": "Tabgha Site", "type": "Place", "meaning": "Historic lakeside location in northern Israel" },
    { "id": 2, "name": "Church of the Multiplication", "type": "Structure / Building", "meaning": "Modern church over early Byzantine remains" },
    { "id": 3, "name": "Mosaic Floor", "type": "Architectural Element", "meaning": "Fifth-century fish and loaves mosaic panel" },
    { "id": 4, "name": "Christian Pilgrims", "type": "Social Group", "meaning": "Visitors seeking spiritual reflection" }
  ],
  "edges": [
    { "from": 2, "to": 1, "label": "located_in" },
    { "from": 3, "to": 2, "label": "part_of" },
    { "from": 4, "to": 2, "label": "used_by" }
  ]
}
```

Master HTML Template (Do Not Modify):
```html
<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>Knowledge Graph</title>
  <link rel="stylesheet"
        href="https://alephplace.com/atar.bot/canvas/knowledge-graph.css"
        crossorigin="anonymous" />
  <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
</head>
<body>
  <div id="mynetwork"></div>

  <div id="infowindow" style="display:none;direction:rtl;text-align:right">
    <span id="closeinfo" style="float:left;cursor:pointer;font-weight:bold">✖</span>
    <h3 id="info_name"></h3>
    <p><strong>סוג:</strong> <span id="info_type"></span></p>
    <p><strong>משמעות:</strong> <span id="info_meaning"></span></p>
  </div>

  <script>
    const DATA = __DATA_JSON__;
  </script>
  <script src="https://alephplace.com/atar.bot/canvas/knowledge-graph.js"></script>
</body>
</html>
```
### Unified KG Schema (Single Spec)
Purpose: one authoritative English schema. Field names and controlled vocab (types, verbs) are English. Property values (`name`, `meaning`, edge `label`) may be any user‑supplied language. `type` MUST use canonical English list from [CA-EC].

Schema:
```jsonc
DATA = {
  "nodes": [
    { "id": 1, "name": "User label", "type": "Structure / Building", "meaning": "5–15 word gloss" }
  ],
  "edges": [
    { "from": 1, "to": 2, "label": "located_in" }
  ]
}
```
Node (required): id (unique), name (user language), type (English canonical), meaning (concise description).  
Edge (required): from, to (existing ids), label (verb – English canonical; may localize at render time only).

Canonical Types (exact match): Place; Structure / Building; Architectural Element; Person; Event; Story / Narrative; Cultural Value; Natural Phenomenon; Artwork / Artefact; Tradition / Custom; Social Group; Historical Period; Religion / Belief; Collective Memory.

Canonical Relationship Verbs: located_in; part_of; associated_with; expresses_value; used_by; influenced_by; commemorates; built_by; represents; related_to.

Rules:
1. Every non–Cultural Value node must have ≥1 outgoing expresses_value edge.
2. Every Cultural Value node must have ≥1 incoming expresses_value edge.
3. `meaning` mandatory (5–15 words, no lists). If empty → block generation.
4. All ids unique; edges must reference existing ids.
5. No inferred facts: all nodes/edges traceable to user content.

Validation Fail Messages (examples):
- Missing meaning: "Node <id> has no meaning – add 5–15 word gloss."
- Orphan value: "Value node <id> has no incoming expresses_value."
- Unvalued entity: "Entity <id> lacks expresses_value edge."

Single Inline HTML Template (embed DATA by replacing __DATA_JSON__ with JSON.stringify(DATA)):
```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Knowledge Graph</title>
  <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
  <style>
    body,#mynetwork{font-family:Calibri,Arial,sans-serif;margin:0;padding:0}
    #mynetwork{width:100%;height:620px;border:1px solid #ccc}
    #infowindow{position:absolute;display:none;background:#fff;border:1px solid #bbb;padding:10px;box-shadow:0 2px 8px rgba(0,0,0,.15);max-width:260px}
    #infowindow h3{margin:0 0 4px;font-size:16px}
    #closeinfo{float:right;cursor:pointer;font-weight:bold}
  </style>
</head>
<body>
  <div id="mynetwork"></div>
  <div id="infowindow">
    <span id="closeinfo">✖</span>
    <h3 id="info_name"></h3>
    <p><strong>Type:</strong> <span id="info_type"></span></p>
    <p><strong>Meaning:</strong> <span id="info_meaning"></span></p>
  </div>
  <script>
    const DATA = __DATA_JSON__;
    const COLOR_BY_TYPE = {
      'Natural Phenomenon':{background:'rgba(30,144,255,0.7)',border:'#1E90FF'},
      'Structure / Building':{background:'rgba(178,34,34,0.7)',border:'#B22222'},
      'Architectural Element':{background:'rgba(129,199,132,0.7)',border:'#81C784'},
      'Person':{background:'rgba(255,105,180,0.7)',border:'#FF69B4'},
      'Event':{background:'rgba(255,160,122,0.7)',border:'#FFA07A'},
      'Story / Narrative':{background:'rgba(255,228,181,0.7)',border:'#FFE4B5'},
      'Social Group':{background:'rgba(255,215,0,0.7)',border:'#FFD700'},
      'Cultural Value':{background:'rgba(255,193,7,0.7)',border:'#FFC107'},
      'Place':{background:'rgba(100,149,237,0.7)',border:'#6495ED'},
      'Artwork / Artefact':{background:'rgba(128,0,128,0.7)',border:'#800080'},
      'Tradition / Custom':{background:'rgba(139,69,19,0.7)',border:'#8B4513'},
      'Historical Period':{background:'rgba(0,180,180,0.7)',border:'#00B4B4'},
      'Religion / Belief':{background:'rgba(218,112,214,0.7)',border:'#DA70D6'},
      'Collective Memory':{background:'rgba(75,0,130,0.7)',border:'#4B0082'},
      'general':{background:'rgba(200,200,200,0.6)',border:'#666'}
    };
    DATA.nodes.forEach(n=>{if(!n.label)n.label=n.name;const col=COLOR_BY_TYPE[n.type]||COLOR_BY_TYPE['general'];n.color=n.color||{background:col.background,border:col.border};});
    const nodes=new vis.DataSet(DATA.nodes);
    const edges=new vis.DataSet(DATA.edges);
    const net=new vis.Network(document.getElementById('mynetwork'),{nodes,edges},{
      nodes:{shape:'box',font:{align:'center',size:14},borderWidth:1,margin:{top:8,right:10,bottom:8,left:10},widthConstraint:{maximum:170}},
      edges:{arrows:{to:{enabled:true,scaleFactor:0.4}},font:{align:'middle',size:11,background:'white'},smooth:{type:'cubicBezier',forceDirection:'horizontal',roundness:0.5}},
      layout:{improvedLayout:true},physics:{enabled:true,solver:'repulsion',repulsion:{nodeDistance:250,centralGravity:0.04,springLength:24,springConstant:0.003,damping:0.09},stabilization:{iterations:1600,fit:true}},interaction:{hover:true,tooltipDelay:300000}
    });
    const info=document.getElementById('infowindow');
    net.on('click',p=>{if(p.nodes.length){const nd=nodes.get(p.nodes[0]);info.style.display='block';document.getElementById('info_name').innerText=nd.name;document.getElementById('info_type').innerText=nd.type;document.getElementById('info_meaning').innerText=nd.meaning||'—';info.style.left=p.pointer.DOM.x+'px';info.style.top=p.pointer.DOM.y+'px';}else info.style.display='none';});
    document.getElementById('closeinfo').onclick=()=>info.style.display='none';
    document.addEventListener('keydown',e=>{if(e.key==='Escape')info.style.display='none';});
  </script>
</body>
</html>
```

Authoring Steps (single pass):
1. Collect raw entities & candidate values from user text.
2. Create Cultural Value nodes (dedupe by meaning).
3. Assign expresses_value edges from each entity to ≥1 value.
4. Add structural/context edges (located_in, part_of, etc.).
5. Fill/trim meanings (5–15 words); validate all rules.
6. Generate HTML by injecting JSON.stringify(DATA) into template.

Diff Guidance: When suggesting edits mid‑conversation, show only altered node/edge lines in a fenced diff block (≤40 changed lines).

